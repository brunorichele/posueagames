<!DOCTYPE html>
<html>
<head>
    <title>BreakOut UEA - GAMES</title>
    <style type="text/css">
        canvas {

            border:1px dashed #000000;
        }
    </style>
</head>
<body onload="init()">

<canvas id="canvas" width="600" height="480">
    Navegador não compatível com HTML5 Canvas
</canvas>
<script>

   var barraHeight, barraWidth,
       jogadorPosY, jogadorPosX,
       bolaPosY,bolaPosX,
       bolaRaio;

   bolaRaio = 10;
   bolaPosX = canvas.width/2;
   bolaPosY = canvas.height/2;
   bolaParaDireita = false;
   bolaAngulo = Math.floor(Math.random() * 21) - 10;
   velocidadeBola = 15;

   var blocosPorLinha = 8;
   var blocoHeight = 20;
   var blocoWidth = canvas.width/blocosPorLinha;
   var scoreJogador = 0;
   var ballX = 300;
   var ballY = 300;
   var paddleX = 200;
   var paddleY = 460;

   var paddleWidth = 100;
   var paddleHeight = 15;

   var paddleDeltaX = 0;
   var paddleDeltaY = 0;


   // layout dos blocos: 1 Laranja, 2 verde, 3 cinza, 0 sem nada
   // gerado a fila de blocos
   var arrayDeBlocos = [
       [1,1,1,1,1,1,1,2],
       [1,1,3,1,0,1,1,1],
       [2,1,2,1,2,1,0,1],
       [1,2,1,1,0,3,1,1],
       [2,0,0,0,0,1,1,2]
   ];

   // criador dos blocos
   function criadorDeBlocos(){
       for (var i=0; i < arrayDeBlocos.length; i++) {
           for (var j=0; j < arrayDeBlocos[i].length; j++) {
               pintaBloco(j,i,arrayDeBlocos[i][j]);
           }
       }
   }

  //pintando cada bloco
   function pintaBloco(x,y,type){
       switch(type){ // if brick is still visible; three colors for three types of bricks
           case 1:
               context.fillStyle = 'orange';
               break;
           case 2:
               context.fillStyle = 'rgb(100,200,100)';
               break;
           case 3:
               context.fillStyle = 'rgba(50,100,50,.5)';
               break;
           default:
               context.clearRect(x*blocoWidth,y*blocoHeight,blocoWidth,blocoHeight);
               break;

       }
       if (type){
           //Draw rectangle with fillStyle color selected earlier
           context.fillRect(x*blocoWidth,y*blocoHeight,blocoWidth,blocoHeight);
           // Also draw blackish border around the brick
           context.strokeRect(x*blocoWidth+1,y*blocoHeight+1,blocoWidth-2,blocoHeight-2);
       }
   }

   //desenhando bola
   function desenhaBola(){

       context.beginPath();// inicia o modo de desenho
       context.fillStyle = 'black';
       context.arc(bolaPosX, bolaPosY, bolaRaio, 0, Math.PI * 2, true); // desenha o círculo desejado com as coordenadas no centro.
       context.closePath();// finaliza o caminho (opcional)
       context.fill();
   }

   function desenhaJogador(){
       barraWidth = 90;
       barraHeight = 30;

       jogadorPosX = (canvas.width - barraWidth)/2 //centralizando o jogador na tela eixo X em baixo;
       jogadorPosY = canvas.height-barraHeight;//colocando o jogado para baixo eixo Y

       //desenhando o Jogador
       context.fillStyle = 'orange';
       context.fillRect(jogadorPosX, jogadorPosY, barraWidth, barraHeight);//desenha jogador
   }

   function desenhaPlacar(){

       //Set the text font and color
       context.fillStyle = 'rgb(50,100,50)';
       context.font = "20px Times New Roman";

       //Clear the bottom 30 pixels of the canvas
       context.clearRect(0,canvas.height-30,canvas.width,30);
       // Write Text 5 pixels from the bottom of the canvas
       context.fillText('Placar: '+scoreJogador,10,canvas.height-5);

   }
   var ballDeltaX;
   var ballDeltaY;

   function moveBall(){
       // First check if we will bump into something

       // If top of the ball touches the top then reverse Y direction
       if (ballY + ballDeltaY - bolaRaio < 0){
           ballDeltaY = -ballDeltaY;
       }

       // If the bottom of the ball touches the bottom of the screen then end the game
       if (ballY + ballDeltaY + bolaRaio > canvas.height){
           endGame();
       }
       // If side of ball touches either side of the wall then reverse X direction
       //left of ball moves too far left
       if ((ballX + ballDeltaX - bolaRaio < 0) ||
           //or right side of ball moves too far right
               (ballX + ballDeltaX + bolaRaio > canvas.width)){
           ballDeltaX = -ballDeltaX;
       }

       // if bottom of ball reaches the top of paddle,
       if (ballY + ballDeltaY + bolaRaio >= paddleY){
           // and it is positioned between the two ends of the paddle (is on top)
           if (ballX + ballDeltaX >= paddleX &&
                   ballX + ballDeltaX <= paddleX + barraWidth){
               ballDeltaY = - ballDeltaY;
           }
       }

       // Move the ball
       ballX = ballX + ballDeltaX;
       ballY = ballY + ballDeltaY;
   }

   function animate () {
       context.clearRect(0,0,canvas.width,canvas.height);
       moveBall();
       movePaddle();
       desenhaJogador();
       desenhaBola();
       //createBricks();
       //displayScoreBoard();
   }

   var paddleDeltaX;
   var paddleSpeedX = 10;

   function movePaddle(){
       if (paddleMove == 'LEFT'){
           paddleDeltaX = -paddleSpeedX;
       } else if (paddleMove == 'RIGHT'){
           paddleDeltaX = paddleSpeedX;
       } else {
           paddleDeltaX = 0;
       }
       // If paddle reaches the ends, then don't let it move
       if (paddleX + paddleDeltaX < 0 || paddleX + paddleDeltaX +barraWidth >canvas.width){
           paddleDeltaX = 0;
       }
       paddleX = paddleX + paddleDeltaX;
   }

   var gameLoop;
   var paddleMove;

   function startGame(){
       ballDeltaY = -4;
       ballDeltaX = -2;
       paddleMove = 'NONE';
       paddleDeltaX = 0;

       // call the animate() function every 200ms until clearInterval(gameLoop) is called
       gameLoop = setInterval(animate,20);
//
//       keyDown();
//       keyUp();

   }

   function endGame(){
       clearInterval(gameLoop);
       context.fillText('The End!!!!',canvas.width/2,canvas.height/2);
   }


   // Start Tracking Keystokes
   function KeyDown(evt) {
       if (evt.keyCode == 39) {
           paddleMove = 'RIGHT';
       } else if (evt.keyCode == 37){
           paddleMove = 'LEFT';
       }
   }

   function KeyUp(evt) {
       if (evt.keyCode == 39) {
           paddleMove = 'NONE';
       } else if (evt.keyCode == 37){
           paddleMove = 'NONE';
       }
   }


   function init(){
        canvas = document.getElementById("canvas");// procura o canvas
        context = canvas.getContext("2d");// recupera o contexto 2d
        context.clearRect(0, 0, canvas.width, canvas.height);// limpa a tela antes de desenhar


       desenhaPlacar();
       desenhaJogador();
       desenhaBola();
       criadorDeBlocos();
       startGame();
    }




</script>



</body>
</html>