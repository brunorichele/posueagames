<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Breakout</title>
            <style type="text/css">
                canvas {
                border:1px dashed #000000;
                }
            </style>
    </head>

    <body onload="init()">
        <canvas id="canvas" width="728" height="880">
            Navegador não compatível com HTML5 Canvas
        </canvas>
        <script>

var canvas, context;
var width, height;
var playerPosX, playerPosY;
var playerWidth, playerHeight;
var ballWidth, ballHeight;
var ballPosX, ballPosY, ballRaio;
var imgSkate, imgBall;
var leftPressed, rightPressed;
var speedPlayer;
var wallMatrix, wallNumRows, wallNumColumns;
var wallWidth, wallHeight, wallMargin;

function init(){
    canvas = document.getElementById("canvas");
    context = canvas.getContext("2d");

    width = 520;
    height = canvas.height;

    playerWidth = 130;
    playerHeight = 40;
    imgSkate = new Image();
    imgSkate.src = "skate.png";

    playerPosX = (width - playerWidth) / 2;
    playerPosY = height - playerHeight;

    ballWidth = 40;
    ballHeight = 40;
    ballRaio = ballWidth/2;
    ballPosX = width / 2;
    ballPosY = height - playerHeight - ballRaio;
    imgBall = new Image();
    imgBall.src = "bola.png";

    leftPressed = false;
    rightPressed = false;
    speedPlayer = 20;

    wallMatrix = new Array();
    wallWidth = 52; 
    wallHeight = 52;
    wallNumRows = 5;
    wallNumColumns = 10;
    wallMargin = 0;
    createWall();

    drawBackground();
    drawBar(imgSkate, playerPosX, playerPosY);
    drawBall(imgBall, ballPosX-ballRaio, ballPosY-ballRaio);

    document.addEventListener('keyup', keyUp, false);
    document.addEventListener('keydown', keyDown, false);
    setInterval(gameLoop, 30);
}

function drawBackground(){
    context.fillStyle = "black"; 
    context.fillRect(0, 0, width, height);
}

function drawBar(img, posX, posY){
    context.drawImage(img, posX, posY, playerWidth, playerHeight);
}

function drawBall(img, posX, posY){
    context.drawImage(img, posX, posY, ballWidth, ballHeight);
}

function createWall() {
    for (var i = 0; i < wallNumRows; i++) { 
        wallMatrix[i] = new Array();
        for (var j = 0; j < wallNumColumns; j++) { 
            var img2 = new Image();
            img2.src = "tijolo.png";
            wallMatrix[i][j] = img2;
        }
    } 
}

function drawWall(){
    for (var i = 0; i < wallNumRows ; i++) { 
        for (var j = 0; j < wallNumColumns; j++) { 
            var img = wallMatrix[i][j];
            if (img != null) {
                context.drawImage(img, (wallWidth + wallMargin) * j , (wallHeight + wallMargin) * i,
                		wallWidth, wallHeight);
            }
        }
    } 
}

function keyDown(e) {
    if (e.keyCode == 37) { 
        leftPressed = true;
    } else if (e.keyCode == 39) { 
        rightPressed = true;
    }
}

function keyUp(e) {
    if (e.keyCode == 37) {
    	leftPressed = false; 
    } else if (e.keyCode == 39) {
    	rightPressed = false;
    }
}

function getBarPosition() {
    if (leftPressed != rightPressed) { 
        if (leftPressed) { 
            if (playerPosX > 0) { 
            	playerPosX -= speedPlayer;
            }
            if(playerPosX < 0){
            	playerPosX = 0;
            }
        } else { 
            if (playerPosX < (width - playerWidth)) {
            	playerPosX += speedPlayer;
            }
            if(playerPosX > (width - playerWidth)){
            	playerPosX = width - playerWidth;
            }
        }
    }
}

function gameLoop() {    
    getBarPosition();
    context.clearRect(0, 0, canvas.width, canvas.height);

    drawBackground();
    drawBar(imgSkate, playerPosX, playerPosY);
    drawBall(imgBall, ballPosX-ballRaio, ballPosY-ballRaio);
    drawWall();
}
        </script>
    </body>
</html>

